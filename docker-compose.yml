services:
  # Наш новый сервис - База Данных
  db:
    image: postgres:15 # Берем готовый официальный образ
    restart: always # Если упадет - поднимется сам
    environment:
      POSTGRES_USER: ${POSTGRES_USER} # Имя «админа» базы
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} # Пароль
      POSTGRES_DB: ${POSTGRES_DB} # Название нашей базы данных
    ports:
      - "5432:5432" # Стандартный порт Postgres

    volumes:
      - ./postgres_data:/var/lib/postgresql/data

  catalog-service:
    build: ./catalog-service
    ## env_file: .env
    ports:
      - "5000:5000"
    environment:
      DB_HOST: db
      DB_PASSWORD: ${DB_PASSWORD} # Теперь он точно возьмет это из .env
    depends_on:
      - db # Говорим: "Не запускай каталог, пока база не готова"

  order-service:
    build: ./order-service
    ## env_file: .env
    ports:
      - "5001:5001"
    environment:
      DB_HOST: db
      DB_PASSWORD: ${DB_PASSWORD} # Теперь он точно возьмет это из .env
    depends_on:
      - catalog-service

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - catalog-service

volumes:
  postgres_data:
